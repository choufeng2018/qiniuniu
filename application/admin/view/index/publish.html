<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="__PUBLIC__/common/css/bootstrap.css">
    <link rel="stylesheet" href="__PUBLIC__/admin/css/main.css"/>
    <link href="__PUBLIC__/ueditor/themes/default/css/ueditor.min.css" rel="stylesheet">
    <script src="__PUBLIC__/common/js/jquery-3.2.1.min.js"></script>
    <script src="__PUBLIC__/common/js/bootstrap.min.js"></script>
    <script charset="utf-8" src="__PUBLIC__/ueditor/ueditor.config.js"></script>
    <script charset="utf-8" src="__PUBLIC__/ueditor/ueditor.all.min.js"></script>
    <script src="__PUBLIC__/ueditor/lang/zh-cn/zh-cn.js"></script>
    <title>后台首页</title>
</head>
<body class="index-body">
<div id="header">
    <nav class="navbar navbar-default">
        <div class="container">
            <div class="logo">

            </div>
        </div>
    </nav>

</div>
<div id="contents">
    <div class="container">
        <div id="content-left" class="col-md-2">
            <div class="menu_box">
                <ul class="menu_box_ul">
                    <li>
                        <ul class="sub_menu">
                            <li class="menu_index"><a href="#" target="main"><i class="fa fa-fw fa-home"></i>首页</a></li>
                        </ul>
                    </li>

                    <li>
                        <h3><i class="fa fa-fw fa-clipboard"></i>资讯中心</h3>
                        <ul class="sub_menu">
                            <li class=""><a href="{:url('admin/index/publish')}" target="main">发布资讯</a></li>
                            <li class=""><a href="{:url('admin/index/plist')}" target="main">资讯列表</a></li>
                        </ul>
                    </li>

                </ul>
            </div>
        </div>
        <div id="content-right" class="col-md-10">
            <div class="result_wrap" name="main">
                <form class="form-horizontal publish-form" onsubmit="return false;">
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">分类：</label>
                        <div class="col-sm-10">
                            <select name="parent_c" id="parent-c" class="form-control" style="width: 20%">
                                <option value="">请选择分类</option>
                                {volist name="select" id="vo"}
                                <option vale="{$vo.id}">{$vo.description}</option>
                                {/volist}
                            </select>
                            <span id="selectMid"></span>
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">文章标题：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="title" name="title"  placeholder="">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">文章封面：</label>
                        <div class="col-sm-10">
                            <button class="btn btn-success btn-img">点此上传封面</button>
                            <input type="text" class="form-control hide" id="img-input" name="banner"  placeholder="">
                            <img class="article-cover" src="#" style="display: none;">
                            <span class="btn .btn-danger">上传该分类下的图片(图片尺寸：300*140)</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label  class="col-sm-2 control-label">文章正文：</label>
                        <div class="col-sm-10" id="emditor-sm-box">
                            <!--style给定宽度可以影响编辑器的最终宽度-->
                            <script type="text/plain" id="myEditor" style="width: 100%; height: 350px;"></script>
                        </div>
                    </div>


                    <div class="form-group publish-box">
                        <div class="col-sm-offset-2 col-sm-10 clearfix">
                            <button class="btn btn-default btn-cancel hide" onclick="javascript: history.back()">取消</button>
                            <button class="btn btn-default btn-preview hide">预览</button>
                            <button type="submit" class="btn btn-primary btn-publish">发布</button>
                        </div>
                    </div>
                </form>
                <form action="#" class="hide" id="cover-form">
                    <input type="file" name="img" id="img" accept="image/*">
                </form>
            </div>
        </div>
    </div>

</div>
<div class="row foot-buttom">
    <div class="col-sm-12">
        <p class="text-center">
            Copyright @ 2014-2017.
            <a href="#">上海臧星阁文化发展有限公司</a>
            All Rights Reserved
            <a>沪ICP备xxxxxx号</a>
        </p>
    </div>
</div>
<script>
    var scope = {};
    //实例化编辑器
    var ue = UE.getEditor('myEditor');
    $(".btn-img").on("click", function () {
        $("#img").click();
    })
    function form_submit(formid, action, callback) {
        var formDom = document.getElementById(formid);
        var formData = new FormData(formDom);
        //
        var req = new XMLHttpRequest();
        req.open("POST",  action);
        req.onreadystatechange = function() {
            if (this.status === 200 && this.readyState === 4) {
                var res = this.response;
                typeof callback == "function" && callback(res)
            }else{
                console.log("错误");
            }
        };
        req.upload.onprogress = function (event) {
            // 进度条
            if (event.lengthComputable) {
                var complete = (event.loaded / event.total * 100 | 0);
                var progress = document.getElementById('uploadprogress');
                if(progress)
                    progress.value = progress.innerHTML = complete;
                // if(complete >= 100){
                //     document.getElementById('uploadprogress').style.display = 'none'
                // }
            }
        };
        // req.addEventListener('loadend' , function () {
        //      document.getElementById('uploadprogress').style.display = 'none'
        // })

        //将form数据发送出去
        req.send(formData);
        //避免内存泄漏
        req = null;

        return req;
    }
    $("#img").on("change", function () {
        form_submit("cover-form","fileUpload", function (res) {
            res = JSON.parse(res) || ""
            if(res.src){
                $("#img-input").val(res.src);
                $(".article-cover").attr("src", '__PUBLIC__/upload/'+decodeURIComponent(res.src)).show();
            }
        })
    })
    // 发布
    $(".btn-publish").on("click", function () {
        var a='哈哈';
        var b=decodeURIComponent(a);
        console.log(b);
       /*var data={};
        data.content = UE.getEditor('myEditor').getContent();
        data.title = $("#title").val();
        data.class = $("#parent-c").val();
        data.banner = $("#img-input").val();
        console.log(data);*/
    })









</script>
</body>
</html>