<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="__PUBLIC__/common/css/bootstrap.css">
    <link rel="stylesheet" href="__PUBLIC__/admin/css/main.css"/>
    <link href="__PUBLIC__/ueditor/themes/default/css/ueditor.min.css" rel="stylesheet">
    <script src="__PUBLIC__/common/js/jquery-3.2.1.min.js"></script>
    <script src="__PUBLIC__/common/js/bootstrap.min.js"></script>
    <script charset="utf-8" src="__PUBLIC__/ueditor/ueditor.config.js"></script>
    <script charset="utf-8" src="__PUBLIC__/ueditor/ueditor.all.min.js"></script>
    <script src="__PUBLIC__/ueditor/lang/zh-cn/zh-cn.js"></script>
    <script src="__PUBLIC__/common/js/util.js"></script>
    <title>后台首页</title>
</head>
<body class="index-body">
<div id="header">
    <nav class="navbar navbar-default">
        <div class="container">
            <div class="logo">
                <img class="img-responsive center-block" src="__PUBLIC__/common/images/logo1.png">
            </div>
        </div>
    </nav>

</div>
<div id="contents">
    <div class="container">
        <div id="content-left" class="col-md-2">
            <div class="menu_box">
                <ul class="menu_box_ul">
                    <li>
                        <ul class="sub_menu">
                            <li class="menu_index"><a href="#" target="main"><i class="fa fa-fw fa-home"></i>首页</a></li>
                        </ul>
                    </li>

                    <li>
                        <h3><i class="fa fa-fw fa-clipboard"></i>资讯中心</h3>
                        <ul class="sub_menu">
                            <li class=""><a href="{:url('admin/index/publish')}" target="main">发布资讯</a></li>
                            <li class=""><a href="{:url('admin/index/plist')}" target="main">资讯列表</a></li>
                        </ul>
                    </li>
                    <li>
                        <h3><i class="fa fa-fw fa-clipboard"></i>产品中心</h3>
                        <ul class="sub_menu">
                            <li class=""><a href="{:url('admin/product/publishwine')}" target="main">发布产品</a></li>
                            <li class=""><a href="{:url('admin/product/winelist')}" target="main">产品列表</a></li>
                        </ul>
                    </li>

                </ul>
            </div>
        </div>
        <div id="content-right" class="col-md-10">
            <div class="result_wrap" name="main">
                <form class="form-horizontal publish-form" onsubmit="return false;">
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">英文标题：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="etitle" name="etitle"  placeholder="">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">汉语标题：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="title" name="title"  placeholder="">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">产地：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="productarea" name="productarea"  placeholder=""  style="width: 20%">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">年份：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="year" name="year"  placeholder="输入例如(2016)）" style="width: 20%">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">品种：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="kind" name="kind"  placeholder="" style="width: 20%">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">酒精度：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="vol" name="vol"  placeholder="输入例如(12)"  style="width: 20%">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">参考价格：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="referprice" name="referprice"  placeholder="输入例如(3.2)）"  style="width: 20%">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">酒品提供：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="winesupply" name="winesupply"  placeholder=""  style="width: 20%">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">外观：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="appearance" name="appearance"  placeholder="输入例如(3.2)"  style="width: 20%">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">香气：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="aroma" name="aroma"  placeholder="输入例如(3.2)"  style="width: 20%">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">滋味：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="taste" name="taste"  placeholder="输入例如(3.2)"  style="width: 20%">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">总体质量：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="quality" name="quality"  placeholder="输入例如(3.2)"  style="width: 20%">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">基本分：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="basescore" name="basescore"  placeholder="输入例如(3.2)"  style="width: 20%">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">总评分：</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="totalscore" name="totalscore"  placeholder="输入例如(3.2)"  style="width: 20%">
                        </div>
                    </div>
                    <div class="form-group group_value">
                        <label  class="col-sm-2 control-label">产品封面：</label>
                        <div class="col-sm-10">
                            <button class="btn btn-success btn-img">点此上传产品封面</button>
                            <input type="text" class="form-control hide" id="img-input" name="banner"  placeholder="">
                            <img class="article-cover" src="#" style="display: none;">
                            <span class="btn .btn-danger">上传该分类下的图片(图片尺寸：300*140)</span>
                        </div>
                    </div>



                    <div class="form-group publish-box">
                        <div class="col-sm-offset-2 col-sm-10 clearfix">
                            <button type="submit" class="btn btn-primary btn-publish">发布</button>
                        </div>
                    </div>
                </form>
                <form action="#" class="hide" id="cover-form">
                    <input type="file" name="img" id="img" accept="image/*" src="__PUBLIC__/upload/history-1.jpg">
                </form>
            </div>
        </div>
    </div>

</div>
<div class="row foot-buttom">
    <div class="col-sm-12">
        <p class="text-center">
            Copyright @ 2014-2017.
            <a href="#">上海臧星阁文化发展有限公司</a>
            All Rights Reserved
            <a>沪ICP备xxxxxx号</a>
        </p>
    </div>
</div>
<script>
    var scope = {};
    //实例化编辑器
    var ue = UE.getEditor('myEditor');
    $(".btn-img").on("click", function () {
        $("#img").click();
    })
    function form_submit(formid, action, callback) {
        var formDom = document.getElementById(formid);
        var formData = new FormData(formDom);
        //
        var req = new XMLHttpRequest();
        req.open("POST",  action);
        req.onreadystatechange = function() {
            if (this.status === 200 && this.readyState === 4) {
                var res = this.response;
                typeof callback == "function" && callback(res)
            }else{
                console.log("错误");
            }
        };
        req.upload.onprogress = function (event) {
            // 进度条
            if (event.lengthComputable) {
                var complete = (event.loaded / event.total * 100 | 0);
                var progress = document.getElementById('uploadprogress');
                if(progress)
                    progress.value = progress.innerHTML = complete;
                // if(complete >= 100){
                //     document.getElementById('uploadprogress').style.display = 'none'
                // }
            }
        };
        // req.addEventListener('loadend' , function () {
        //      document.getElementById('uploadprogress').style.display = 'none'
        // })

        //将form数据发送出去
        req.send(formData);
        //避免内存泄漏
        req = null;

        return req;
    }
    $("#img").on("change", function () {
        form_submit("cover-form","fileUpload", function (res) {
            res = JSON.parse(res) || ""
            if(res.src){
                $("#img-input").val(res.src);
                $(".article-cover").attr("src", '__PUBLIC__/upload/'+decodeURIComponent(res.src)).show();
            }
        })
    })
    // 发布
    $(".btn-publish").on("click", function () {

        var data={};

        data.etitle = $("#etitle").val();
        data.title = $("#title").val();
        data.productarea = $("#productarea").val();
        data.year = $("#year").val();
        data.kind = $("#kind").val();
        data.vol = $("#vol").val();
        data.referprice = $("#referprice").val();
        data.winesupply = $("#winesupply").val();
        data.appearance = $("#appearance").val();
        data.aroma = $("#aroma").val();
        data.taste = $("#taste").val();
        data.quality = $("#quality").val();
        data.basescore = $("#basescore").val();
        data.totalscore = $("#totalscore").val();
        data.banner = $("#img-input").val();
        //console.log(data);
        $.ajax({
            url: 'addProduct',
            type:"POST",
            data:data,
            dataType: 'json',
            success:function (res) {
                if(res.success){
                    location.href='winelist';
                }else{
                    alert(res.msg);
                }

            }
        })
    })
    //修改

    var arr = location.href.split('?');
    var hehe = arr[1].split('=');
    var id = hehe[1];
    $.ajax({
        url:"modify",
        data:{"id":id}, //以键/值对的形式
        async : true,
        dataType : "json",
        success : function(data) {
            $("#edit").val(data.id);
            $("#title").val(data.title);
            $("#author").val(data.author);
            $("#source").val(data.source);
            $("#parent-c").val(data.cid);
            $(".article-cover").attr("src", '__PUBLIC__/upload/'+data.banner).show();
            ue.ready(function(){
                ue.setContent(data.content);
            })

        }
    });










</script>
</body>
</html>